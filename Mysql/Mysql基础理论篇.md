## 相关知识的理解和笔记(一)

    |--------------------------------------------

     Author:       intro                        
     CreateAt:     2018-10-20 15:05:13         
  
    |--------------------------------------------

### 基础理论篇
数据库的使用，相对直接使用文件存储而言，就是使数据有优化地存取。包括存和取两个方面的服务。Mysql在这方面的所作的工作，首先从结构上，分为：`连接层`、`服务（接口）层`、`引擎层`、`存储层`。接下来分别理解一下，这几层的作用：

#### 连接层
它是用来处理客户端对服务端的连接的。mysql采用C/S模式，即客户端和服务端的方式进行服务，一个服务端可以为多个客户端建立服务。服务端对多个客户端进行服务时，是一个处理建立连接，调度以及相关处理和，断开连接的过程。这些操作都是由连接层进行处理的。就客户端和服务端的通信而言，底层通信采用的是tcp协议簇。应用层使用socket进行连接，所以有支持客户端的长连接和短连接。

#### 服务层
服务层也称为接口层，用于处理，客户端和服务端建立连接以后，所要对客户端的真正意图进行服务的处理。比如说，客户端这次的操作是查询(select)相关的操作，这个时候服务层，先调用查询优化器（query optimizer）来进行优化和翻译成适合引擎层执行的接口调用，来交给引擎层处理。我们所说的，数据库的优化，也就是指的这一层上的优化。如何写出适合的sql，其实就是看写出如何满足查询优化器的相关规则的查询语句。`再多说一句，在实际应用中，数据库的读写比例一般为20/1，也就是20次读对应一次的写`，所以数据库会注重数据的读取的优化来提高效率。

#### 引擎层
引擎层就是我们常说的数据引擎，像MyIsam,InnorDB,csv,merge……，为什么会有这么多引擎呢？首先我感觉可以试着理解一下，什么是引擎？我们可以类比一下汽车，我们把汽车的发动机，就叫做引擎。它的作用是提供动力，它有很多种类型的，是自然吸气(L)，有涡轮增压(T)。如果一个汽车的引擎不合适，那么整个车的性能必然发挥不出最好的优势。比如，一个中大型的suv，给配个1.0排量的自然吸气的发动机。能跑，但很累，或是给一个包面对，配一人3.6排量的发动机。。也能跑，但浪费。。而从数据库的角度来说。不同的数据引擎对应的不同场景的业务需求，有些需要更快速的查询，而有些需要更安全有性的数据保证。

mysql在创建数据库表的时候进行指定数据引擎，当然也可以后期修改为另一个数据引擎，注意这里说的是`表`，并不是指整个数据库。可以理解为，数据引擎的操作单元就是表。我们常用的就两种数据引擎，MyIsam和InnorDB.面试官最喜欢问的就是这两个引擎的区别。先说说它们各自的特点：
 
 **MyIsam**的优势在于查询，它对查询做了很大的优化。
 
    1.不支持事务、
    2.不支持外键、
    3.表级锁 因为是表锁，只需要对要操作的表锁一次，所以单次操作很快。
>      也因为是表锁，所以在高并发的情况下会容易出现死锁，你把表都锁了，别人只能等你操作完成后解锁才可以进行，所以不利于高并发的场景下选择。
 
**InnorDB**是数据库默认的数据引擎，优势在于可以实现操作的原子性，算是弥补了MyIsam的不足
 
    1.支持事务、
    2.支持外键、
    3.行级锁 因为是行锁，所以要对影响到的行都进行锁操作，相对MyIsam就会慢一些。
对于数据引擎的选择，一般是取决于，对表的操作是读取居多，还是写入居多。如果读取居多，建议选择MyIsam,相反就选择InnorDB会更合适些。

#### 存储层
存储层，就是对应的表在硬盘上的真实存储空间了。结合引擎层的存取算法实现真实数据和表数据的映射。这里主要介绍一下**索引**，索引是除了表数据以后，另一个额外空间开销。这个空间的开销对于查询优化来说，是必不可少的。Mysql默认的索引采用的算法是**B tree**,B tree是一种特殊的树结构，要求，左边结点比右边结点的元素值都大的一种数据结构。这种对查询来说，找到一个元素，需要查询的次数就大大的减少了，所以查询速度自然就能得到提升。B tree的算法在mysql里的真实实现，远比这个复杂得多，而且目前mysql只采用了3层的B tree，由叶子结点来存储数据，其它结点都是存储指针。这个展开又是一个无底洞。对于我们使用者来说，了解有这个东西就好了。

再说回索引，索引是数据库优化的一大利器。加上索引和不加索引的区别是非常明显的提升。但是，并不是为每一个字段都加上索引，就一定取得更好的效果。每增加一个索引需要的额外空间开销不说，每次的插入、更新 、删除的操作，都需要对索引部分进行相应的更新。这个就得不偿失了。所以权衡一个字段的索引是否需要，得根实际的需求场景来决定。如果某一个字段经常需要做为条件来约束，那自然是要加上的。

关于索引的类型，以及在实现应用中如何考量是否需要，这个在优化部分再详述


